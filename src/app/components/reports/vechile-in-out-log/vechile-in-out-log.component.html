<form [formGroup]="reportForm" class="container-fluid">

  <div class="row mt-3 g-2 align-items-end">

   <div class="col-12 col-md-2">
  <label class="fw-bold">From Date & Time</label>

  <div class="row g-1">
    <!-- DATE (WIDE) -->
    <div class="col-8">
      <mat-form-field appearance="outline" class="w-100">
        <input
          matInput
          [matDatepicker]="fromPicker"
          formControlName="fromDate"
          placeholder="Date"
        />
        <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
        <mat-datepicker #fromPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- TIME (COMPACT) -->
    <div class="col-4">
      <input
        type="time"
        class="form-control"
        formControlName="fromTime"
      />
    </div>
  </div>
</div>




    <div class="col-12 col-md-2">
  <label class="fw-bold">To Date & Time</label>

  <div class="row g-1">
    <!-- DATE -->
    <div class="col-8">
      <mat-form-field appearance="outline" class="w-100">
        <input
          matInput
          [matDatepicker]="toPicker"
          formControlName="toDate"
          placeholder="Date"
        />
        <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
        <mat-datepicker #toPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- TIME -->
    <div class="col-4">
      <input
        type="time"
        class="form-control"
        formControlName="toTime"
      />
    </div>
  </div>
</div>




    <!-- VEHICLE TYPE -->
    <div class="col-12 col-md-2">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Vehicle Type</mat-label>
        <mat-select multiple formControlName="vehicleType">
          <mat-option *ngFor="let v of vehicleTypes" [value]="v.value">
            {{ v.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- IN / OUT -->
    <div class="col-12 col-md-2">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>IN / OUT</mat-label>
        <mat-select multiple formControlName="inOut">
          <mat-option *ngFor="let io of inOutOptions" [value]="io.value">
            {{ io.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- NEIGHBOURHOOD -->
    <div class="col-12 col-md-2">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Neighbourhood</mat-label>
        <mat-select multiple formControlName="project" (selectionChange)="onProjectChange()">
          <mat-option (click)="selectAll('project')">All</mat-option>
          <mat-option *ngFor="let p of projectList" [value]="p">{{ p }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- BUILDING -->
    <div class="col-12 col-md-2">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Building</mat-label>
        <mat-select multiple formControlName="building" (selectionChange)="onBuildingChange()">
          <mat-option (click)="selectAll('building')">All</mat-option>
          <mat-option *ngFor="let b of buildingList" [value]="b">{{ b }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- SEARCH BY -->
    <div class="col-12 col-md-2">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Search By</mat-label>
        <mat-select formControlName="searchBy">
          <mat-option value="vehicleNumber">Reg No</mat-option>
          <mat-option value="stickerNo">Vehicle StickerNo</mat-option>
          <mat-option value="vMake">Vehicle Make</mat-option>
          <mat-option value="vColor">Color</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- SEARCH TEXT -->
    <div class="col-12 col-md-2">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Search</mat-label>
        <input matInput formControlName="searchValue" placeholder="Enter text..." />
      </mat-form-field>
    </div>

    <!-- BUTTONS -->
    <div class="col-auto d-flex gap-2 align-items-center">
      <button class="btn" type="button" (click)="showReports()">Search</button>
      <button class="btn" type="button" (click)="showAll()">Clear</button>
      <button class="btn" type="button" *ngIf="pagedData.length" (click)="exportExcel()">Excel</button>
      <button class="btn" type="button" *ngIf="pagedData.length" (click)="exportPDF()">PDF</button>
    </div>

  </div>

  <div class="table-responsive mt-3">
  <table class="table table-bordered table-hover table-striped"
         style="table-layout:auto; white-space:nowrap;">
    <thead class="table-dark">
      <tr>
         <th>Sr No</th>
        <th (click)="sortColumn('vehicleNumber')">
          Vehicle No
          <span *ngIf="getSortColumn() === 'vehicleNumber'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th (click)="sortColumn('ownerName')">
          Name
          <span *ngIf="getSortColumn() === 'ownerName'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th (click)="sortColumn('building')">
          Building
          <span *ngIf="getSortColumn() === 'building'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th (click)="sortColumn('flatNumber')">
          Flat
          <span *ngIf="getSortColumn() === 'flatNumber'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th (click)="sortColumn('vehicleCategory')">
          Vehicle Type
          <span *ngIf="getSortColumn() === 'vehicleCategory'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th (click)="sortColumn('cameraLocation')">
          Location
          <span *ngIf="getSortColumn() === 'cameraLocation'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th (click)="sortColumn('inoutFlag')">
          IN/OUT
          <span *ngIf="getSortColumn() === 'inoutFlag'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th (click)="sortColumn('inoutTime')">
          Time
          <span *ngIf="getSortColumn() === 'inoutTime'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>

        <th (click)="sortColumn('vMake')">
  Make
  <span *ngIf="getSortColumn() === 'vMake'">
    {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
  </span>
</th>

<th (click)="sortColumn('stickerNo')">
  Sticker No
  <span *ngIf="getSortColumn() === 'stickerNo'">
    {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
  </span>
</th>

<th (click)="sortColumn('vColor')">
  Color
  <span *ngIf="getSortColumn() === 'vColor'">
    {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
  </span>
</th>

        <th (click)="sortColumn('nrdName')">
          Neighbourhood
          <span *ngIf="getSortColumn() === 'nrdName'">
            {{ getSortDirection() === 'asc' ? '▲' : '▼' }}
          </span>
        </th>
        <th>Image</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngIf="!pagedData.length">
        <td colspan="11" class="text-center">No Data Found</td>
      </tr>
      <tr *ngFor="let d of pagedData; let i = index">
        <td>{{ i + 1 + paginator.pageIndex * paginator.pageSize }}</td>
        <td>{{ d.vehicleNumber }}</td>
        <td>{{ d.ownerName }}</td>
        <td>{{ d.building }}</td>
        <td>{{ d.flatNumber }}</td>
        <td>{{ d.vehicleCategory }}</td>
        <td>{{ d.cameraLocation }}</td>
        <td>{{ d.inoutFlag }}</td>
       <td>{{ d.inoutTime | date:'dd-MM-yyyy HH:mm' }}</td>
<td>{{ d.vMake }}</td>
<td>{{ d.stickerNo }}</td>
<td>{{ d.vColor }}</td>

        <td>{{ d.nrdName }}</td>
        <td>
          <button *ngIf="d.cameraImage" class="btn btn-sm btn-primary" (click)="openImage(d.cameraImage)">View</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<mat-paginator
    [pageSizeOptions]="[10, 25, 50, 100,150,200,250,300]"
    [pageSize]="10"
    showFirstLastButtons
    (page)="updatePagination()">
  </mat-paginator>
</form>
